import{Q as F,a as M}from"./QItem.98cb2d4c.js";import{Q as P}from"./QSelect.3768a279.js";import{Q as z}from"./QInput.ec90feeb.js";import{x as D,v as T,r as Q,aq as U,y as $,q as n,z as C,t as o,d as t,u as a,s as _,aa as x,ab as E,ac as j,A as l,B as d,Q as K}from"./index.16fafb50.js";import{Q as O}from"./QForm.5f43623c.js";import{Q as G}from"./QBanner.f76ac382.js";import{a as H,Q as J}from"./QCard.9550f461.js";import{Q as W}from"./QPage.bd9db12d.js";import{u as X}from"./useVerPeriodoActivo.75af6eda.js";import{_ as Y}from"./LoaderSpinner.196fa089.js";import{u as Z}from"./useVerEstudiante.0b73f0d7.js";import{u as ee}from"./useObtenerEmpresas.ce7d49b0.js";import{d as q}from"./documentosApi.d4af84c5.js";import{_ as oe}from"./BreadcrumbNav.24a9f6cf.js";import{u as te}from"./useQueryClient.esm.ad4fb503.js";import{u as se}from"./useMutation.esm.3aac1ad5.js";import"./use-dark.fd3c0586.js";import"./use-key-composition.749118dd.js";import"./uid.42677368.js";import"./focus-manager.05708ea9.js";import"./QChip.fc1367d4.js";import"./QItemLabel.bb4f8a3f.js";import"./QMenu.ab6378a2.js";import"./selection.fb3d903a.js";import"./focusout.5c99f0fb.js";import"./QDialog.82b87909.js";import"./use-prevent-scroll.175dc396.js";import"./use-form.e491c393.js";import"./format.2bc25e5f.js";import"./useQuery.esm.48506497.js";import"./utils.esm.429db25b.js";import"./useRecursoIndividual.f202693b.js";import"./useRecursosMultiples.fa0015da.js";import"./axios.a596eead.js";import"./mutation.esm.54ea4acf.js";const ae=m=>{const f=async p=>{try{const{data:c}=await q.patch("/asignar-residencia/"+m,p);return c}catch(c){throw c}},g=D(),u=te(),{mutate:y,isLoading:b}=se(f,{onSuccess:()=>{u.invalidateQueries({queryKey:["estudiantes",m],exact:!1}),g.push({name:"ver-estudiante",params:{id:m}})}});return{mutate:y,isLoading:b}},re={key:1},ie={key:0,class:"fontsize-14 text-center text-weight-light flex items-center"},ne={class:"row q-col-gutter-md"},le={class:"col-xs-12 col-sm-8"},ce=l("span",{class:"required-star"},"*",-1),de={class:"col-xs-12 col-sm-8"},me=l("span",{class:"required-star"},"*",-1),ue={class:"col-xs-12 col-sm-7"},pe={key:2},_e={key:3},We=T({__name:"AsignarResidencia",setup(m){const{resource:f,isLoading:g,error:u}=X(),{data:y,isLoading:b}=ee(),p=Q(y.value),c=U(),{id:V=""}=c.params,{resource:v}=Z(V+""),r=Q({empresa_id:"",proyecto:""}),k=Q(!1),A=async(s,i)=>{const h=s===""?"":s;k.value=!0;const e=await q.get("/empresas-select",{params:{nombre:h}});let w=e.data;if(s){const R=s.toLowerCase();w=e.data.filter(I=>I.nombre.toLowerCase().includes(R))}i(()=>{p.value=w,k.value=!1})},{mutate:L,isLoading:S}=ae(V+""),B=async()=>{try{const s={empresa_id:r.value.empresa_id.id,proyecto:r.value.proyecto};L(s)}catch(s){console.log(s)}},N=[{label:"Estudiantes",icon:"school",to:"listar-estudiante"},{label:"Asignar residencia",icon:"add_reaction"}];return(s,i)=>{const h=$("RouterLink");return n(),C(W,{padding:""},{default:o(()=>[t(oe,{pages:N,titlePage:"Asignar residencia"}),t(J,null,{default:o(()=>[t(H,null,{default:o(()=>[a(g)&&a(b)?(n(),C(Y,{key:0})):a(f)?(n(),_("div",re,[a(v)?(n(),_("div",ie," Asignar residencia a "+x(a(v).nombre)+" "+x(a(v).apellidos),1)):E("",!0),t(O,{onSubmit:j(B,["prevent"])},{default:o(()=>[l("div",ne,[l("div",le,[t(P,{clearable:"",modelValue:r.value.empresa_id,"onUpdate:modelValue":i[0]||(i[0]=e=>r.value.empresa_id=e),"use-input":"","hide-selected":"","fill-input":"",options:p.value,"option-value":"id","option-label":"nombre","input-debounce":"0","label-slot":"",onFilter:A,rules:[e=>!!e||"Selecciona una empresa"]},{label:o(()=>[d(" Empresa de residencia "),ce]),"no-option":o(()=>[t(F,null,{default:o(()=>[t(M,{class:"text-grey"},{default:o(()=>[d(" No hay resultados ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","rules"])]),l("div",de,[t(z,{modelValue:r.value.proyecto,"onUpdate:modelValue":i[1]||(i[1]=e=>r.value.proyecto=e),rules:[e=>!!e||"El nombre del proyecto es requerido",e=>e.length>3&&e.length<250||"Debe tener m\xE1s de 2 caracteres y menos de 250"],"label-slot":""},{label:o(()=>[d(" Nombre del proyecto "),me]),_:1},8,["modelValue","rules"])]),l("div",ue,[t(K,{label:"Asignar residencia",color:"primary",type:"submit",loading:a(S)},null,8,["loading"])])])]),_:1},8,["onSubmit"])])):(n(),_("div",pe,[t(G,{"inline-actions":"",class:"text-white bg-red"},{default:o(()=>[d(" No hay un periodo activo, necesitas tener un periodo activo primero, puedes editar los periodos en la lista de periodos "),t(h,{to:{name:"listar-periodo"}},{default:o(()=>[d("Ir a periodos")]),_:1})]),_:1})])),a(u)?(n(),_("div",_e,x(a(u)),1)):E("",!0)]),_:1})]),_:1})]),_:1})}}});export{We as default};
