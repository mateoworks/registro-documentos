import{Q as M}from"./QBanner.f76ac382.js";import{Q as P}from"./QSelect.3768a279.js";import{r as w,x as R,v as N,aq as U,c as Y,q as c,z as x,t as o,d as t,u as n,s as f,aa as g,ab as C,ac as D,A as l,B as v,ar as $,F as z,ao as k,as as I,Q as L}from"./index.16fafb50.js";import{Q as K}from"./QDate.75e05ac0.js";import{Q as T}from"./QPopupProxy.2db034ac.js";import{Q as j}from"./QInput.ec90feeb.js";import{Q as O}from"./QFile.0d542f19.js";import{Q as G}from"./QForm.5f43623c.js";import{a as H,Q as J}from"./QCard.9550f461.js";import{Q as W}from"./QPage.bd9db12d.js";import{C as X}from"./ClosePopup.159f4ab9.js";import{u as Z}from"./useVerEstudiante.0b73f0d7.js";import{_ as ee}from"./LoaderSpinner.196fa089.js";import{_ as oe}from"./BreadcrumbNav.24a9f6cf.js";import{u as te}from"./useObtenerPendientesEstudiante.ffad7dcf.js";import{d as ae}from"./date.eb8942c3.js";import{d as se}from"./documentosApi.d4af84c5.js";import{u as re}from"./useQueryClient.esm.ad4fb503.js";import{u as ne}from"./useMutation.esm.3aac1ad5.js";import{g as le}from"./errorUtils.9be85d5d.js";import"./use-dark.fd3c0586.js";import"./use-key-composition.749118dd.js";import"./uid.42677368.js";import"./focus-manager.05708ea9.js";import"./QChip.fc1367d4.js";import"./QItem.98cb2d4c.js";import"./QItemLabel.bb4f8a3f.js";import"./QMenu.ab6378a2.js";import"./selection.fb3d903a.js";import"./focusout.5c99f0fb.js";import"./QDialog.82b87909.js";import"./use-prevent-scroll.175dc396.js";import"./use-form.e491c393.js";import"./format.2bc25e5f.js";import"./use-cache.b0833c75.js";import"./useRecursoIndividual.f202693b.js";import"./useQuery.esm.48506497.js";import"./utils.esm.429db25b.js";import"./axios.a596eead.js";import"./mutation.esm.54ea4acf.js";const ie=Q=>{const _=re(),i=w(null),u=R(),b=async m=>{try{const{data:r}=await se.post("/entregas",m,{headers:{"Content-Type":"multipart/form-data"}});return r}catch(r){throw r}},{mutate:y,isLoading:h,error:s,isSuccess:d,status:V}=ne(b,{onSuccess:()=>{_.invalidateQueries({queryKey:["entregas"],exact:!1}),_.invalidateQueries({queryKey:["entrega-por-residente",Q],exact:!1}),u.push({name:"ver-residente",params:{id:Q}})},onError:m=>{var r;m.response?i.value=(r=m.response)==null?void 0:r.data:i.value=m}});return{createEntrega:y,isLoadingCreate:h,error:s,errorServer:i,isSuccess:d,status:V}},ue={key:1},de={key:0,class:"fontsize-14 text-center text-weight-light flex items-center"},me={class:"row q-col-gutter-md"},ce={class:"col-12"},pe={class:"col-xs-12 col-sm-8"},_e=l("span",{class:"required-star"},"*",-1),fe={class:"col-xs-12 col-sm-8"},ge=l("span",{class:"required-star"},"*",-1),ve={class:"row items-center justify-end"},Qe={class:"col-xs-12 col-sm-8"},be={class:"col-xs-12 col-sm-7"},no=N({__name:"AgregarDocumentoResidente",setup(Q){var S;const _=U(),{id:i=""}=_.params,{resource:u,isLoading:b}=Z(i+""),{data:y,isLoading:h}=te(i+""),s=w({estudiante_id:(S=u.value)==null?void 0:S.id,documento_id:"",url_documento:null,fecha_entrega:"",estado:!0}),d=w(ae.formatDate(new Date,"YYYY/MM/DD")),{createEntrega:V,isLoadingCreate:m,errorServer:r}=ie(i+""),E=r.value,F=()=>{const p=new FormData;p.append("estudiante_id",i+""),p.append("documento_id",s.value.documento_id+""),p.append("fecha_entrega",d.value+""),s.value.url_documento&&p.append("url_documento",s.value.url_documento[0]),V(p)},A=Y(()=>le(r.value)),B=[{label:"Residentes",icon:"school",to:"listar-residente"},{label:"Agregar documentos",icon:"assignment_turned_in"}];return(p,a)=>(c(),x(W,{padding:""},{default:o(()=>[t(oe,{pages:B,titlePage:"Agregar documento"}),t(J,null,{default:o(()=>[t(H,null,{default:o(()=>[n(b)?(c(),x(ee,{key:0})):n(u)?(c(),f("div",ue,[n(u)?(c(),f("div",de," Asignar documentos de "+g(n(u).nombre)+" "+g(n(u).apellidos),1)):C("",!0)])):C("",!0),t(G,{onSubmit:D(F,["prevent"])},{default:o(()=>[l("div",me,[l("div",ce,[n(r)?(c(),x(M,{key:0,"inline-actions":"",class:"text-white bg-red"},{default:o(()=>{var e;return[v(g(((e=n(E))==null?void 0:e.message)||"")+" ",1),l("ul",null,[(c(!0),f(z,null,$(A.value,q=>(c(),f("li",{key:q},g(q),1))),128))])]}),_:1})):C("",!0)]),l("div",pe,[t(P,{modelValue:s.value.documento_id,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value.documento_id=e),options:n(y),"option-value":"id","option-label":"nombre","emit-value":"","map-options":"","label-slot":"",rules:[e=>!!e||"Selecciona un documeto"],loading:n(h)},{label:o(()=>[v(" Documento: "),_e]),_:1},8,["modelValue","options","rules","loading"])]),l("div",fe,[t(j,{modelValue:d.value,"onUpdate:modelValue":a[2]||(a[2]=e=>d.value=e),mask:"date",rules:[e=>!!e||"La fecha es requerida"],"label-slot":""},{label:o(()=>[v(" Fecha de entrega "),ge]),append:o(()=>[t(k,{name:"event",class:"cursor-pointer"},{default:o(()=>[t(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[t(K,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=e=>d.value=e)},{default:o(()=>[l("div",ve,[I(t(L,{label:"Close",color:"primary",flat:""},null,512),[[X]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])]),l("div",Qe,[t(O,{"bottom-slots":"",modelValue:s.value.url_documento,"onUpdate:modelValue":a[5]||(a[5]=e=>s.value.url_documento=e),"label-slot":"",counter:"",multiple:"",accept:".doc, .docx, .pdf"},{label:o(()=>[v(" Formato llenado: ")]),prepend:o(()=>[t(k,{name:"cloud_upload",onClick:a[3]||(a[3]=D(()=>{},["stop","prevent"]))})]),append:o(()=>[t(k,{name:"close",onClick:a[4]||(a[4]=D(e=>s.value.url_documento=null,["stop","prevent"])),class:"cursor-pointer"})]),_:1},8,["modelValue"])]),l("div",be,[t(L,{label:"Agregar documento",color:"primary",type:"submit",loading:n(m)},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1}))}});export{no as default};
