import{aU as w,aV as Q,v as P,r as k,x as z,q as c,s as E,d as t,u as g,z as x,t as d,ab as S,A as e,aa as _,F as K,ar as A,Q as f}from"./index.16fafb50.js";import{a as F,Q as D}from"./QCard.9550f461.js";import{Q as U}from"./QPage.bd9db12d.js";import{Q as j}from"./QBtnGroup.8a143a29.js";import{Q as M}from"./QMarkupTable.c292dae4.js";import{Q as T}from"./QPagination.0ffb27c3.js";import{d as B}from"./documentosApi.d4af84c5.js";import{_ as G}from"./DialogEliminar.48da2dec.js";import{_ as I}from"./LoaderSpinner.196fa089.js";import{u as H}from"./useQueryClient.esm.ad4fb503.js";import{u as J}from"./useMutation.esm.3aac1ad5.js";import{u as O}from"./useQuery.esm.48506497.js";import{_ as W}from"./BreadcrumbNav.24a9f6cf.js";import{g as X}from"./getUser.66bacbda.js";import"./use-dark.fd3c0586.js";import"./QInput.ec90feeb.js";import"./use-key-composition.749118dd.js";import"./uid.42677368.js";import"./focus-manager.05708ea9.js";import"./use-form.e491c393.js";import"./format.2bc25e5f.js";import"./axios.a596eead.js";import"./QCardActions.4c1c4976.js";import"./QDialog.82b87909.js";import"./use-prevent-scroll.175dc396.js";import"./focusout.5c99f0fb.js";import"./ClosePopup.159f4ab9.js";import"./utils.esm.429db25b.js";import"./mutation.esm.54ea4acf.js";const Y=y=>{const n=H(),a=async s=>{try{Q.show({delay:500,message:"Eliminando..."}),await B.delete(`entregas/${s}`),Q.hide()}catch(h){throw Q.hide(),h}},{mutate:i,isLoading:l,error:p,isSuccess:v}=J(a,{onSuccess:()=>{w.create({message:"Se elimin\xF3 la entrega",color:"positive",position:"top-right",type:"positive"}),n.invalidateQueries({queryKey:["entregas",y]}),n.invalidateQueries({queryKey:["entregas-trashed"],exact:!1}),n.invalidateQueries({queryKey:["entrega-por-residente"],exact:!1})},onError:s=>{w.create({message:s+"",color:"negative",position:"top-right",type:"negative"})}});return{eliminarRecurso:i,loadingEliminar:l,error:p,isSuccess:v}},Z=e("thead",null,[e("tr",null,[e("th",null,"Residente"),e("th",null,"Fecha entrega"),e("th",null,"Documento"),e("th",null,"Acci\xF3n")])],-1),ee={class:"q-mt-md flex justify-end items-center"},te={class:"q-mr-md"},ae=P({__name:"TablaEntrega",setup(y){const n=async r=>{const{data:u}=await B.get("/entregas",{params:{page:r.value,perPage:15,included:"estudiante,documento"}});return u},a=k(1),i=z(),l=k(!1),p=k(""),{isLoading:v,data:s}=O({queryKey:["entregas",a],queryFn:()=>n(a),keepPreviousData:!0}),{eliminarRecurso:h}=Y(a.value),R=r=>{i.push({name:"ver-entrega",params:{id:r}})},L=r=>{i.push({name:"editar-entrega",params:{id:r}})},N=r=>{l.value=!0,p.value=r};return(r,u)=>{var C;return c(),E("div",null,[t(G,{modelValue:l.value,"onUpdate:modelValue":u[0]||(u[0]=m=>l.value=m),"recurso-id":p.value,onEliminar:g(h)},null,8,["modelValue","recurso-id","onEliminar"]),g(v)?(c(),x(I,{key:0})):g(s)?(c(),x(M,{key:1},{default:d(()=>{var m;return[Z,e("tbody",null,[(c(!0),E(K,null,A((m=g(s))==null?void 0:m.data,o=>{var b,V,$;return c(),E("tr",{key:o.id},[e("td",null,_((b=o.estudiante)==null?void 0:b.nombre)+" "+_((V=o.estudiante)==null?void 0:V.apellidos),1),e("td",null,_(o.fecha_entrega),1),e("td",null,_(($=o.documento)==null?void 0:$.nombre_documento),1),e("td",null,[t(j,{push:""},{default:d(()=>[t(f,{size:"sm",color:"info",push:"",glossy:"",icon:"visibility",onClick:q=>R(o.id)},null,8,["onClick"]),t(f,{size:"sm",color:"secondary",push:"",glossy:"",icon:"edit",onClick:q=>L(o.id)},null,8,["onClick"]),t(f,{size:"sm",color:"negative",push:"",glossy:"",icon:"delete",onClick:q=>N(o.id)},null,8,["onClick"])]),_:2},1024)])])}),128))])]}),_:1})):S("",!0),e("div",ee,[e("div",te,"P\xE1gina: "+_(a.value),1),t(T,{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=m=>a.value=m),max:((C=g(s))==null?void 0:C.meta.last_page)||1,"direction-links":"",flat:"",color:"grey","active-color":"primary"},null,8,["modelValue","max"])])])}}}),re={class:"flex justify-between items-center"},oe=e("div",{class:"fontsize-15 text-weight-light"},"Entregas",-1),Re=P({__name:"ListarEntrega",setup(y){const n=[{label:"Entregas",icon:"assignment_turned_in"}],a=z(),i=()=>{a.push({name:"crear-entrega"})};return X(),(l,p)=>(c(),x(U,{padding:""},{default:d(()=>[t(W,{pages:n,titlePage:"Lista de entregas"}),t(D,null,{default:d(()=>[t(F,null,{default:d(()=>[e("div",re,[oe,t(f,{label:"Nuevo",icon:"add_circle_outline",color:"secondary",size:"md",padding:"xs",onClick:i})])]),_:1}),t(F,null,{default:d(()=>[t(ae)]),_:1})]),_:1})]),_:1}))}});export{Re as default};
